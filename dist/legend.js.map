{"version":3,"sources":["../src/legend.js"],"names":[],"mappings":"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","file":"legend.js","sourcesContent":["import angular from 'angular';\nimport _ from  'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport $ from  'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.time';\n\nangular.module('grafana.directives').directive('piechartLegend', function() {\n  return {\n    link: function(scope, elem) {\n      var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      var data;\n      var seriesList;\n      var i;\n\n      ctrl.events.on('render', function() {\n        data = ctrl.series;\n        if (data) {\n          for(var i in data) {\n            data[i].color = ctrl.data[i].color;\n          }\n          render();\n        }\n      });\n\n      function getSeriesIndexForElement(el) {\n        return el.parents('[data-series-index]').data('series-index');\n      }\n\n      function toggleSeries(e) {\n        var el = $(e.currentTarget);\n        var index = getSeriesIndexForElement(el);\n        var seriesInfo = seriesList[index];\n        ctrl.toggleSeries(seriesInfo, e);\n      }\n\n      function sortLegend(e) {\n        var el = $(e.currentTarget);\n        var stat = el.data('stat');\n\n        if (stat !== panel.legend.sort) { panel.legend.sortDesc = null; }\n\n        // if already sort ascending, disable sorting\n        if (panel.legend.sortDesc === false) {\n          panel.legend.sort = null;\n          panel.legend.sortDesc = null;\n          render();\n          return;\n        }\n\n        panel.legend.sortDesc = !panel.legend.sortDesc;\n        panel.legend.sort = stat;\n        render();\n      }\n\n      function getTableHeaderHtml(statName) {\n        if (!panel.legend[statName]) { return \"\"; }\n        var html = '<th class=\"pointer\" data-stat=\"' + statName + '\">' + statName;\n\n        if (panel.legend.sort === statName) {\n          var cssClass = panel.legend.sortDesc ? 'fa fa-caret-down' : 'fa fa-caret-up' ;\n          html += ' <span class=\"' + cssClass + '\"></span>';\n        }\n\n        return html + '</th>';\n      }\n\n      function render() {\n        if(panel.legendType === 'On graph') {\n          $container.empty();\n          return;\n        }\n\n        if (firstRender) {\n          elem.append($container);\n          $container.on('click', '.graph-legend-alias', toggleSeries);\n          $container.on('click', 'th', sortLegend);\n          firstRender = false;\n        }\n\n        seriesList = data;\n\n        $container.empty();\n\n        $container.toggleClass('graph-legend-table', panel.legendType === 'Table');\n\n        if (panel.legend.legendType === 'Table') {\n          var header = '<tr>';\n          header += '<th colspan=\"2\" style=\"text-align:left\"></th>';\n          if (panel.legend.values) {\n            header += getTableHeaderHtml('min');\n            header += getTableHeaderHtml('max');\n            header += getTableHeaderHtml('avg');\n            header += getTableHeaderHtml('current');\n          }\n          header += '</tr>';\n          $container.append($(header));\n        }\n\n        if (panel.legend.sort) {\n          seriesList = _.sortBy(seriesList, function(series) {\n            return series.stats[panel.legend.sort];\n          });\n          if (panel.legend.sortDesc) {\n            seriesList = seriesList.reverse();\n          }\n        }\n\n        for (i = 0; i < seriesList.length; i++) {\n          var series = seriesList[i];\n\n          // ignore empty series\n          if (panel.legend.hideEmpty && series.allIsNull) {\n            continue;\n          }\n          // ignore series excluded via override\n          if (!series.legend) {\n            continue;\n          }\n\n          var html = '<div class=\"graph-legend-series';\n          html += '\" data-series-index=\"' + i + '\">';\n          html += '<span class=\"graph-legend-icon\" style=\"float:none;\">';\n          html += '<i class=\"fa fa-minus pointer\" style=\"color:' + series.color + '\"></i>';\n          html += '</span>';\n\n          html += '<span class=\"graph-legend-alias\" style=\"float:none;\">';\n          html += '<a>' + series.label + '</a>';\n          html += '</span>';\n\n          if (panel.legend.values && panel.legendType === 'Table') {\n            var avg = series.formatValue(series.stats.avg);\n            var current = series.formatValue(series.stats.current);\n            var min = series.formatValue(series.stats.min);\n            var max = series.formatValue(series.stats.max);\n\n            if (panel.legend.min) { html += '<div class=\"graph-legend-value min\">' + min + '</div>'; }\n            if (panel.legend.max) { html += '<div class=\"graph-legend-value max\">' + max + '</div>'; }\n            if (panel.legend.avg) { html += '<div class=\"graph-legend-value avg\">' + avg + '</div>'; }\n            if (panel.legend.current) { html += '<div class=\"graph-legend-value current\">' + current + '</div>'; }\n          }\n\n          html += '</div>';\n          $container.append($(html));\n        }\n      }\n    }\n  };\n});\n\n\n"]}